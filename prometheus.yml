# Prometheus Configuration for Fake News Detector
# This file defines what metrics to scrape and how often

global:
  # How often to scrape targets by default
  scrape_interval: 15s

  # How long until a scrape request times out
  scrape_timeout: 10s

  # How often to evaluate rules
  evaluation_interval: 15s

  # Attach these labels to any time series or alerts when communicating with
  # external systems (federation, remote storage, Alertmanager)
  external_labels:
    monitor: "fakenews-detector"
    environment: "production"

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"
          component: "monitoring"

  # Fake News Detector API metrics
  - job_name: "fakenews-api"
    scrape_interval: 10s # Scrape more frequently for API metrics
    scrape_timeout: 5s
    metrics_path: "/metrics" # The endpoint where metrics are exposed
    static_configs:
      - targets: ["api:8000"] # Docker service name and port
        labels:
          service: "fakenews-api"
          component: "application"
          app: "ml-service"

    # Relabel configurations (optional - for custom label manipulation)
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "fakenews-api-service"

  # MLflow Tracking Server (if it exposes metrics)
  - job_name: "mlflow"
    scrape_interval: 30s
    scrape_timeout: 10s
    metrics_path: "/metrics"
    static_configs:
      - targets: ["mlflow:5000"]
        labels:
          service: "mlflow"
          component: "ml-tracking"

    # Continue scraping even if this target is down
    honor_labels: true

    # Optional: Only scrape if MLflow exposes Prometheus metrics
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: "mlflow_.*"
        action: keep
# Alerting configuration (optional - for future use)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# Rule files (optional - for recording rules and alerts)
# rule_files:
#   - "alert_rules.yml"
#   - "recording_rules.yml"

# Storage configuration
# Prometheus stores data locally by default
# Retention: 15 days (can be changed with --storage.tsdb.retention.time flag)

# Remote write configuration (optional - for long-term storage)
# remote_write:
#   - url: "http://remote-storage:9201/write"

# Remote read configuration (optional - for querying remote storage)
# remote_read:
#   - url: "http://remote-storage:9201/read"
