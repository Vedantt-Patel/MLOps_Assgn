<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Fake News Detector</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #333;
        min-height: 100vh;
        padding: 20px;
      }

      .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      header h1 {
        font-size: 2rem;
        color: #1e3c72;
      }

      .back-link {
        color: #1e3c72;
        text-decoration: none;
        padding: 10px 20px;
        border: 2px solid #1e3c72;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .back-link:hover {
        background: #1e3c72;
        color: #fff;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }

      .stat-card h3 {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .stat-card .value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #1e3c72;
      }

      .stat-card .subtitle {
        font-size: 0.85rem;
        color: #999;
        margin-top: 5px;
      }

      .data-table-container {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .data-table-container h2 {
        margin-bottom: 20px;
        color: #1e3c72;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .refresh-btn {
        background: #1e3c72;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .refresh-btn:hover {
        background: #2a5298;
        transform: scale(1.05);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      thead {
        background: #1e3c72;
        color: #fff;
      }

      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
      }

      tbody tr {
        transition: background 0.2s ease;
      }

      tbody tr:hover {
        background: #f5f8fa;
      }

      .prediction-real {
        color: #00b09b;
        font-weight: bold;
      }

      .prediction-fake {
        color: #ff6b6b;
        font-weight: bold;
      }

      .feedback-correct {
        color: #00b09b;
      }

      .feedback-incorrect {
        color: #ff6b6b;
      }

      .feedback-pending {
        color: #999;
        font-style: italic;
      }

      .stars {
        color: #ffd700;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 1.1rem;
      }

      .no-data {
        text-align: center;
        padding: 60px;
        color: #999;
        font-size: 1.1rem;
      }

      .text-truncate {
        max-width: 300px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .confidence {
        font-weight: 600;
      }

      .timestamp {
        font-size: 0.85rem;
        color: #666;
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }

        table {
          font-size: 0.85rem;
        }

        th,
        td {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <header>
        <h1>üìä Fake News Detector Dashboard</h1>
        <a href="/" class="back-link">‚Üê Back to Detector</a>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Predictions</h3>
          <div class="value" id="totalPredictions">-</div>
          <div class="subtitle">All time</div>
        </div>

        <div class="stat-card">
          <h3>Accuracy</h3>
          <div class="value" id="accuracy">-</div>
          <div class="subtitle">Based on user feedback</div>
        </div>

        <div class="stat-card">
          <h3>Average Rating</h3>
          <div class="value" id="avgRating">-</div>
          <div class="subtitle">Out of 5 stars</div>
        </div>

        <div class="stat-card">
          <h3>Today's Predictions</h3>
          <div class="value" id="todayPredictions">-</div>
          <div class="subtitle">Last 24 hours</div>
        </div>
      </div>

      <div class="data-table-container">
        <h2>
          Recent Predictions
          <button class="refresh-btn" onclick="loadDashboardData()">
            üîÑ Refresh
          </button>
        </h2>

        <div id="tableContent">
          <div class="loading">Loading data...</div>
        </div>
      </div>
    </div>

    <script>
      // Load dashboard data on page load
      loadDashboardData();

      // Auto-refresh every 30 seconds
      setInterval(loadDashboardData, 30000);

      async function loadDashboardData() {
        try {
          // Fetch statistics
          const statsResponse = await fetch("http://127.0.0.1:8000/api/stats");
          const stats = await statsResponse.json();

          // Update stat cards
          document.getElementById("totalPredictions").textContent =
            stats.total_predictions || 0;
          document.getElementById("accuracy").textContent = stats.accuracy
            ? `${stats.accuracy}%`
            : "N/A";
          document.getElementById("avgRating").textContent =
            stats.average_rating ? `${stats.average_rating}/5` : "N/A";
          document.getElementById("todayPredictions").textContent =
            stats.today_predictions || 0;

          // Fetch predictions data
          const predictionsResponse = await fetch(
            "http://127.0.0.1:8000/api/predictions?limit=50"
          );
          const predictionsData = await predictionsResponse.json();
          const predictions = predictionsData.predictions;

          // Render table
          if (predictions && predictions.length > 0) {
            renderTable(predictions);
          } else {
            document.getElementById("tableContent").innerHTML =
              '<div class="no-data">No predictions yet. Start by checking some news!</div>';
          }
        } catch (error) {
          console.error("Error loading dashboard data:", error);
          document.getElementById("tableContent").innerHTML =
            '<div class="no-data">Error loading data. Please check if the server is running.</div>';
        }
      }

      function renderTable(predictions) {
        const tableHTML = `
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Prediction</th>
                <th>Confidence</th>
                <th>User Feedback</th>
                <th>Rating</th>
                <th>Timestamp</th>
              </tr>
            </thead>
            <tbody>
              ${predictions
                .map(
                  (p) => `
                <tr>
                  <td>${p.id}</td>
                  <td class="text-truncate" title="${escapeHtml(
                    p.title || "No title"
                  )}">${p.title || "<i>No title</i>"}</td>
                  <td class="prediction-${p.prediction.toLowerCase()}">${
                    p.prediction
                  }</td>
                  <td class="confidence">${(p.confidence * 100).toFixed(
                    1
                  )}%</td>
                  <td>${renderFeedback(p.user_feedback)}</td>
                  <td>${renderRating(p.user_rating)}</td>
                  <td class="timestamp">${formatTimestamp(p.timestamp)}</td>
                </tr>
              `
                )
                .join("")}
            </tbody>
          </table>
        `;

        document.getElementById("tableContent").innerHTML = tableHTML;
      }

      function renderFeedback(feedback) {
        if (!feedback) {
          return '<span class="feedback-pending">Pending</span>';
        }
        const className =
          feedback === "correct" ? "feedback-correct" : "feedback-incorrect";
        const icon = feedback === "correct" ? "‚úì" : "‚úó";
        return `<span class="${className}">${icon} ${
          feedback.charAt(0).toUpperCase() + feedback.slice(1)
        }</span>`;
      }

      function renderRating(rating) {
        if (!rating) {
          return '<span class="feedback-pending">-</span>';
        }
        return `<span class="stars">${"‚òÖ".repeat(rating)}${"‚òÜ".repeat(
          5 - rating
        )}</span>`;
      }

      function formatTimestamp(timestamp) {
        if (!timestamp) return "N/A";
        const date = new Date(timestamp);
        return date.toLocaleString();
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }
    </script>
  </body>
</html>
